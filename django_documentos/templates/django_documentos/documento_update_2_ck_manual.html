{% load staticfiles %}
{% load spurl %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="robots" content="noindex, nofollow">
    <title>Editar</title>
    <link type="text/css"
            {#          href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-center-atom.css"#}
            {#          href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-center-simple.css"#}
            {#          href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-barber-shop.css"#}
          href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-loading-bar.css"
          rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"
            data-pace-options='{ "ajax": false , "restartOnRequestAfter": false, "document": false}'></script>


    {#    <link type="text/css" href="{% static "django_documentos/bootstrap/bootstrap-3.3.5-dist/css/bootstrap.min.css" %}"#}
    {#          rel="stylesheet">#}
    <link type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"
          rel="stylesheet">

    {#    <link type="text/css"#}
    {#          href="{% static "django_documentos/bootstrap/bootstrap-3.3.5-dist/css/bootstrap-theme.min.css" %}"#}
    {#          rel="stylesheet">#}
    <link type="text/css"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"
          rel="stylesheet">

    {#    <link type="text/css"#}
    {#          href="{% static "django_documentos/bootstrap/bootstrap-3.3.5-dist/fonts/glyphicons-halflings-regular.eot" %}"#}
    {#          rel="stylesheet">#}
    <link type="text/css"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/fonts/glyphicons-halflings-regular.eot"
          rel="stylesheet">


    <style>
        {#        body {#}
        {#            min-width: 860px; /* suppose you want minimun width of 1000px */#}
        {#            width: auto !important; /* Firefox will set width as auto */#}
        {#            width: 860px; /* As IE ignores !important it will set width as 1000px; */#}
        {#        }#}

        .maindiv {
            display: none;
        }

        .body {
            background: rgb(204, 204, 204);
        }

        {#        .menu-superior:after {#}
        {#            padding: 100px;#}
        {#        }#}

        .menu-inferior, .menu-superior {

        }

        .doc-cabecalho {

        }

        .doc-rodape {

        }

        .doc-container {
            display: table;
        }

        .doc-content {
            display: table-row;
            height: 100%;
        }

        .doc-content-body {
            display: table-cell;
        }

        #conteudo {
        {#            padding: 230px 0;#} display: block;

        }

        #conteudo textarea, iframe {
            border: none;

        }

        article {
            background: white;
            width: 21cm;
            height: 29.7cm;
            display: block;
            margin: 0 auto 0.5cm;
            box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);

            padding: 30px;
            font-size: 11pt;
        {#            font-family: Arial;#} text-justify: distribute;
            line-height: 22pt;
        {#            position: absolute;#}{#            padding: 0 0 0 0;#}{#            overflow: auto;#} margin-bottom: 250px
        }

        article form {
            height: 100%;
        }

        @media print {
            body, article[size="A4"] {
                margin: 0;
                box-shadow: 0;
                background: transparent;
            }

        }

        {#        .cktop:after {#}
        {#            margin-bottom: 40px;#}
        {#        }#}

        .no-print {
            display: block;
        }

        @media print {
            .cke_pagebreak {
                display: block;
                page-break-before: always;
            }
        }


    </style>


    {#    <script src="{% static "django_documentos/js/jquery/1.11.3/jquery.min.js" %}"></script>#}
    {#    <script src="{% static "django_documentos/bootstrap/bootstrap-3.3.5-dist/js/bootstrap.min.js" %}"></script>#}
    {#    <script src="http://cdn.ckeditor.com/4.5.2/standard-all/ckeditor.js"></script>#}
    {#    #}
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    {#    <script src="http://cdn.ckeditor.com/4.5.2/full-all/ckeditor.js"></script>#}
    <script src="{% static "ckeditor/ckeditor/ckeditor.js" %}"></script>

</head>

<body class="body">
<div class="maindiv">
    <header id="menu-superior" class="navbar-fixed-top on menu-superior">
        <div class="btn-toolbar cke_top">
            <div class="btn-group">
                <button class="btn btn-default" data-original-title="Save - Ctrl+S" onclick="saveArt();"><i
                        class="glyphicon glyphicon-floppy-disk"></i>Salvar
                </button>
                <button class="btn btn-default" data-original-title="Print - Ctrl+P"><i
                        class="glyphicon glyphicon-print"></i>Imprimir
                </button>
            </div>
        </div>
        <div id="top" class="cktop">
            <!-- Menu superior CKEditor -->
        </div>
    </header>


    <div id="conteudo">
        <article class="doc-container">

            <!-- Conteudo -->
            <form method="post" id="formulario">
                {% csrf_token %}
                {#            {{ form }}#}
                <header id="ta-cabecalho" class="header ta-cabecalho">
                    {{ form.cabecalho }}
                </header>

                <section id="ta-conteudo" class="doc-content">
                    <div class="doc-content-body">
                        {{ form.conteudo }}
                    </div>
                </section>

                <footer id="ta-rodape" class="footer ta-rodape">
                    {{ form.rodape }}
                </footer>


            </form>
        </article>
    </div>
    <footer id="menu-inferior" class="navbar-fixed-bottom menu-inferior">
        <div id="bottom">
            <!--  Menu inferior CKEditor  -->
        </div>
        <div class="btn-toolbar cke_bottom" style="alignment: left;">
            <button class="btn btn-default" id="areateste">
            </button>
        </div>
    </footer>
</div>
<script>
    function get_ckenabledElementIds() {
        return $('[data-djckeditor]').map(function (i) {
            return this.id;
        }).get();
    }

    var ckenabledElementIds = get_ckenabledElementIds();


    var ckeditor_config = {
        extraPlugins: [
            'sharedspace',
            'save',
            'autolink',
            {#            'autogrow'#}
        ].join(),
        removePlugins: 'resize',
        'sharedSpaces': {
            'top': 'top',
            'bottom': 'bottom'
        },
        addCss: '.cke_reset { border: none; box-shadow: none; }',
        {#        autoGrow_onStartup: true,#}
        contentsCss: 'html, iframe, body {overflow:hidden;outline: none;}',
        startupShowBorders: false,
        toolbarGroups: [
            {name: 'document', groups: ['mode', 'document', 'doctools']},
            {name: 'clipboard', groups: ['clipboard', 'undo']},
            {name: 'editing', groups: ['find', 'selection', 'spellchecker', 'editing']},
            {name: 'forms', groups: ['forms']},
            {#            '/',#}
            {name: 'basicstyles', groups: ['basicstyles', 'cleanup']},
            {name: 'paragraph', groups: ['list', 'indent', 'blocks', 'align', 'bidi', 'paragraph']},
            {name: 'links', groups: ['links']},
            {name: 'insert', groups: ['insert']},
            '/',
            {name: 'styles', groups: ['styles']},
            {name: 'colors', groups: ['colors']},
            {name: 'tools', groups: ['tools']},
            {name: 'others', groups: ['others']},
            {name: 'about', groups: ['about']}
        ],
        removeButtons: 'Save,NewPage,Preview,Print,Templates,Form,Checkbox,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,CreateDiv,BidiLtr,BidiRtl,Language,Anchor,Unlink,Link,Flash,Smiley,SpecialChar,Iframe,About'
    };

    function startCkEditor() {
        return ckenabledElementIds.map(function (id_elemento) {
            return {id_elemento: CKEDITOR.replace(id_elemento, ckeditor_config)};
        });
    }

    var ckeditor_instances = startCkEditor();

    $('#post-form').on('submit', function (event) {
        event.preventDefault();
        console.log("form submitted!")  // sanity check
        create_post();
    });


    function create_post() {
        {#        ckeditor_instances.map(function(editor_instance){#}
        {#            editor_instance.updateElement();#}
        {#        });#}
        for (instance in CKEDITOR.instances) {
            CKEDITOR.instances[instance].updateElement();
        }

        var request = $.ajax({
            url: '/update2/8/?popup=1',
            type: 'POST',
            method: "POST",
            data: $("#formulario").serialize()
            {#            data: {id: menuId},#}
            {#            dataType: "html"#}
        });

        request.done(function (msg) {
            $("#areateste").html(msg);
        });

        request.fail(function (jqXHR, textStatus) {
            alert("Request failed: " + textStatus);
        });

        return false;

    }
</script>


<script>
    $(function () {


        // Submit post on submit
        $('#formulario-form').on('submit', function (event) {
            event.preventDefault();
            console.log("form submitted!");  // sanity check
            create_post();
        });

        // AJAX for posting
        function create_post() {
            console.log("create post is working!"); // sanity check
            $.ajax({
                url: "/update2/8/?popup=1",//"create_post/", // the endpoint
                type: "POST", // http method
                data: {the_post: $("#formulario").serialize()}, // data sent with the post request
                // handle a successful response
                success: function (json) {
                    $('#formulario-text').val(''); // remove the value from the input
                    console.log(json); // log the returned json to the console
                    $("#talk").prepend("<li><strong>" + json.pk + "</strong> - <em> " + json.conteudo + "</em> - <span> " + json.created +
                            "</span> - <a id='delete-post-" + json.pk + "'>delete me</a></li>");
                    console.log("success"); // another sanity check
                },
                // handle a non-successful response
                error: function (xhr, errmsg, err) {
                    $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: " + errmsg +
                            " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
                    console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
                }
            });
        }


        // This function gets cookie with a given name
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');

        /*
         The functions below will create a header with csrftoken
         */

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        function sameOrigin(url) {
            // test that a given url is a same-origin URL
            // url could be relative or scheme relative or absolute
            var host = document.location.host; // host + port
            var protocol = document.location.protocol;
            var sr_origin = '//' + host;
            var origin = protocol + sr_origin;
            // Allow absolute or scheme relative URLs to same origin
            return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
                    (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
                        // or any other URL that isn't scheme relative or absolute i.e relative.
                    !(/^(\/\/|http:|https:).*/.test(url));
        }

        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!csrfSafeMethod(settings.type) && sameOrigin(settings.url)) {
                    // Send the token to same-origin, relative URLs only.
                    // Send the token only if the method warrants CSRF protection
                    // Using the CSRFToken value acquired earlier
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });

    });

</script>

{#{% if form %}#}
{#    {{ form.media }}#}
{#{% endif %}#}
<script>

    function corrigir_padding_conteudo() {
        var menusuperior = $('#menu-superior');
        var conteudo = $('#conteudo');
        var altura_menu_superior = parseInt(menusuperior.css('height').replace(/[^-\d\.]/g, ''));
        var valor = "".concat(altura_menu_superior + 130).concat("px");
        conteudo.css('padding-top', valor);
    }
    {#    $(window).resize(function () {#}
    {#        corrigir_padding_conteudo();#}
    {#    });#}
    window.addEventListener('resize', corrigir_padding_conteudo, false);

</script>


<script>

    Pace.on('hide', function () {

        $(".maindiv").fadeIn("fast");
        corrigir_padding_conteudo();
    });
    {#    $(window).load(function () {#}
    {#        $("body").fadeIn("slow");#}
    {#    });#}
</script>
{#<script>#}
{#    function resizeToMinimum() {#}
{#        var minimum = [878, 600];#}
{#        var current = [window.outerWidth, window.outerHeight];#}
{#        var restricted = [];#}
{#        var i = 2;#}
{##}
{#        while (i-- > 0) {#}
{#            restricted[i] = mimimum[i] > current[i] ? minimum[i] : current[i];#}
{#        }#}
{#        console.log("redimencionando x:" + current[0] + " - y:" + current[1]);#}
{#        window.resizeTo(current[0], current[1]);#}
{##}
{#    }#}
{##}
{#    window.addEventListener('resize', resizeToMinimum, false)#}
{#</script>#}


</body>

</html>