/*
 Copyright (c) 2003-2014, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
(function(){function t(a){return CKEDITOR.env.ie?a.$.clientWidth:parseInt(a.getComputedStyle("width"),10)}function n(a,h){var b=a.getComputedStyle("border-"+h+"-width"),i={thin:"0px",medium:"1px",thick:"2px"};0>b.indexOf("px")&&(b=b in i&&"none"!=a.getComputedStyle("border-style")?i[b]:0);return parseInt(b,10)}function w(a){var h=[],b=-1,i="rtl"==a.getComputedStyle("direction"),d;d=a.$.rows;for(var p=0,f,c,e,j=0,o=d.length;j<o;j++)e=d[j],f=e.cells.length,f>p&&(p=f,c=e);d=c;p=new CKEDITOR.dom.element(a.$.tBodies[0]);
f=p.getDocumentPosition();c=0;for(e=d.cells.length;c<e;c++){var j=new CKEDITOR.dom.element(d.cells[c]),o=d.cells[c+1]&&new CKEDITOR.dom.element(d.cells[c+1]),b=b+(j.$.colSpan||1),k,g,l=j.getDocumentPosition().x;i?g=l+n(j,"left"):k=l+j.$.offsetWidth-n(j,"right");o?(l=o.getDocumentPosition().x,i?k=l+o.$.offsetWidth-n(o,"right"):g=l+n(o,"left")):(l=a.getDocumentPosition().x,i?k=l:g=l+a.$.offsetWidth);j=Math.max(g-k,3);h.push({table:a,index:b,x:k,y:f.y,width:j,height:p.$.offsetHeight,rtl:i})}return h}
function u(a){(a.data||a).preventDefault()}function A(a){function h(){j=0;e.setOpacity(0);k&&b();var v=f.table;setTimeout(function(){v.removeCustomData("_cke_table_pillars")},0);c.removeListener("dragstart",u)}function b(){for(var v=f.rtl,d=v?l.length:x.length,b=0;b<d;b++){var c=x[b],e=l[b],i=f.table;CKEDITOR.tools.setTimeout(function(a,b,c,e,d,f){a&&a.setStyle("width",g(Math.max(b+f,1)));c&&c.setStyle("width",g(Math.max(e-f,1)));d&&i.setStyle("width",g(d+f*(v?-1:1)))},0,this,[c,c&&t(c),e,e&&t(e),
(!c||!e)&&t(i)+n(i,"left")+n(i,"right"),k])}a.fire("tableResize")}function i(a){u(a);for(var a=f.index,b=CKEDITOR.tools.buildTableMap(f.table),i=[],h=[],g=Number.MAX_VALUE,n=g,s=f.rtl,r=0,w=b.length;r<w;r++){var m=b[r],q=m[a+(s?1:0)],m=m[a+(s?0:1)],q=q&&new CKEDITOR.dom.element(q),m=m&&new CKEDITOR.dom.element(m);if(!q||!m||!q.equals(m))q&&(g=Math.min(g,t(q))),m&&(n=Math.min(n,t(m))),i.push(q),h.push(m)}x=i;l=h;y=f.x-g;z=f.x+n;e.setOpacity(0.5);o=parseInt(e.getStyle("left"),10);k=0;j=1;e.on("mousemove",
p);c.on("dragstart",u);c.on("mouseup",d,this)}function d(a){a.removeListener();h()}function p(a){r(a.data.getPageOffset().x)}var f,c,e,j,o,k,x,l,y,z;c=a.document;e=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',c);a.on("destroy",function(){e.remove()});s||c.getDocumentElement().append(e);
this.attachTo=function(a){j||(s&&(c.getBody().append(e),k=0),f=a,e.setStyles({width:g(a.width),height:g(a.height),left:g(a.x),top:g(a.y)}),s&&e.setOpacity(0.25),e.on("mousedown",i,this),c.getBody().setStyle("cursor","col-resize"),e.show())};var r=this.move=function(a){if(!f)return 0;if(!j&&(a<f.x||a>f.x+f.width))return f=null,j=k=0,c.removeListener("mouseup",d),e.removeListener("mousedown",i),e.removeListener("mousemove",p),c.getBody().setStyle("cursor","auto"),s?e.remove():e.hide(),0;a-=Math.round(e.$.offsetWidth/
2);if(j){if(a==y||a==z)return 1;a=Math.max(a,y);a=Math.min(a,z);k=a-o}e.setStyle("left",g(a));return 1}}function r(a){var h=a.data.getTarget();if("mouseout"==a.name){if(!h.is("table"))return;for(var b=new CKEDITOR.dom.element(a.data.$.relatedTarget||a.data.$.toElement);b&&b.$&&!b.equals(h)&&!b.is("body");)b=b.getParent();if(!b||b.equals(h))return}h.getAscendant("table",1).removeCustomData("_cke_table_pillars");a.removeListener()}var g=CKEDITOR.tools.cssLength,s=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||
CKEDITOR.env.quirks);CKEDITOR.plugins.add("tableresize",{requires:"tabletools",init:function(a){a.on("contentDom",function(){var h,b=a.editable();b.attachListener(b.isInline()?b:a.document,"mousemove",function(b){var b=b.data,d=b.getTarget();if(d.type==CKEDITOR.NODE_ELEMENT){var g=b.getPageOffset().x;if(h&&h.move(g))u(b);else if(d.is("table")||d.getAscendant("tbody",1)){d=d.getAscendant("table",1);if(!(b=d.getCustomData("_cke_table_pillars")))d.setCustomData("_cke_table_pillars",b=w(d)),d.on("mouseout",
r),d.on("mousedown",r);a:{for(var d=0,f=b.length;d<f;d++){var c=b[d];if(g>=c.x&&g<=c.x+c.width){g=c;break a}}g=null}g&&(!h&&(h=new A(a)),h.attachTo(g))}}})})}})})();