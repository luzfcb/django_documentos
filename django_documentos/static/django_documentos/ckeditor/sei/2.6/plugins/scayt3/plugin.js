CKEDITOR.plugins.add("scayt3",{requires:"menubutton,dialog",lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en-au,en-ca,en-gb,en,eo,es,et,eu,fa,fi,fo,fr-ca,fr,gl,gu,he,hi,hr,hu,is,it,ja,ka,km,ko,lt,lv,mk,mn,ms,nb,nl,no,pl,pt-br,pt,ro,ru,sk,sl,sr-latn,sr,sv,th,tr,ug,uk,vi,zh-cn,zh",icons:"scayt",hidpi:!0,tabToOpen:null,dialogName:"scaytDialog",init:function(a){var d=this,b=CKEDITOR.plugins.scayt3;this.bindEvents(a);this.parseConfig(a);this.addRule(a);CKEDITOR.dialog.add(this.dialogName,CKEDITOR.getUrl(this.path+
"dialogs/options.js"));this.addMenuItems(a);var c=a.lang.scayt3,g=CKEDITOR.env;a.ui.add("Scayt",CKEDITOR.UI_MENUBUTTON,{label:c.text_title,title:a.plugins.wsc?a.lang.wsc.title:c.text_title,modes:{wysiwyg:!(g.ie&&(8>g.version||g.quirks))},toolbar:"spellchecker,20",refresh:function(){var c=a.ui.instances.Scayt.getState();a.scayt&&(c=b.state[a.name]?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF);a.fire("scaytButtonState",c)},onRender:function(){var b=this;a.on("scaytButtonState",function(a){void 0!==typeof a.data&&
b.setState(a.data)})},onMenu:function(){var c=a.scayt;a.getMenuItem("scaytToggle").label=a.lang.scayt3[c&&b.state[a.name]?"btn_disable":"btn_enable"];c={scaytToggle:CKEDITOR.TRISTATE_OFF,scaytOptions:c?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,scaytLangs:c?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,scaytDict:c?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,scaytAbout:c?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,WSC:a.plugins.wsc?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED};
a.config.scayt_uiTabs[0]||delete c.scaytOptions;a.config.scayt_uiTabs[1]||delete c.scaytLangs;a.config.scayt_uiTabs[2]||delete c.scaytDict;return c}});a.contextMenu&&a.addMenuItems&&(a.contextMenu.addListener(function(){var b=a.scayt,c;if(b){var h=b.getSelectionNode();if(h=h?h.getAttribute(b.getNodeAttribute()):h)c=d.menuGenerator(a,h,d),b.showBanner("."+a.contextMenu._.definition.panel.className.split(" ").join(" ."))}return c}),a.contextMenu._.onHide=CKEDITOR.tools.override(a.contextMenu._.onHide,
function(b){return function(){var c=a.scayt;c&&c.hideBanner();return b.apply(this)}}))},addMenuItems:function(a){var d=this,b=CKEDITOR.plugins.scayt3;a.addMenuGroup("scaytButton");var c=a.config.scayt_contextMenuItemsOrder.split("|");if(c&&c.length)for(var g=0;g<c.length;g++)a.addMenuGroup("scayt_"+c[g],g-10);c={scaytToggle:{label:a.lang.scayt3.btn_enable,group:"scaytButton",onClick:function(){var c=a.scayt;b.state[a.name]=!b.state[a.name];!0===b.state[a.name]?c||b.createScayt(a):c&&b.destroy(a)}},
scaytAbout:{label:a.lang.scayt3.btn_about,group:"scaytButton",onClick:function(){a.scayt.tabToOpen="about";a.lockSelection();a.openDialog(d.dialogName)}},scaytOptions:{label:a.lang.scayt3.btn_options,group:"scaytButton",onClick:function(){a.scayt.tabToOpen="options";a.lockSelection();a.openDialog(d.dialogName)}},scaytLangs:{label:a.lang.scayt3.btn_langs,group:"scaytButton",onClick:function(){a.scayt.tabToOpen="langs";a.lockSelection();a.openDialog(d.dialogName)}},scaytDict:{label:a.lang.scayt3.btn_dictionaries,
group:"scaytButton",onClick:function(){a.scayt.tabToOpen="dictionaries";a.lockSelection();a.openDialog(d.dialogName)}}};a.plugins.wsc&&(c.WSC={label:a.lang.wsc.toolbar,group:"scaytButton",onClick:function(){var b=CKEDITOR.plugins.scayt3,c=a.scayt,h=a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?a.container.getText():a.document.getBody().getText();(h=h.replace(/\s/g,""))?(c&&(b.state[a.name]&&c.setMarkupPaused)&&c.setMarkupPaused(!0),a.lockSelection(),a.execCommand("checkspell")):alert("Nothing to check!")}});
a.addMenuItems(c)},bindEvents:function(a){var d=CKEDITOR.plugins.scayt3,b=a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE;CKEDITOR.on("dialogDefinition",function(a){if("scaytDialog"===a.data.name)a.data.definition.dialog.on("cancel",function(){return!1},this,null,-1)});var c=function(){a.scayt&&d.destroy(a)},g=function(){d.state[a.name]&&!a.readOnly&&d.createScayt(a)},f=function(){var b=a.editable();b.attachListener(b,"focus",function(){var b=CKEDITOR.plugins.scayt3&&CKEDITOR.plugins.scayt3.state[a.name]&&
a.scayt;b&&b.setMarkupPaused(!1)},this,null,-10);b.attachListener(b,"blur",function(){var b=CKEDITOR.plugins.scayt3&&CKEDITOR.plugins.scayt3.state[a.name]&&a.scayt;b&&b.setMarkupPaused(!0)},this,null,-10)},e=function(){b?(a.on("blur",c),a.on("focus",g),a.focusManager.hasFocus&&g()):g();f()};a.on("focus",function(){var b=CKEDITOR.plugins.scayt3&&CKEDITOR.plugins.scayt3.state[a.name]&&a.scayt;b&&b.setMarkupPaused(!1)},0);a.on("blur",function(){var b=CKEDITOR.plugins.scayt3&&CKEDITOR.plugins.scayt3.state[a.name]&&
a.scayt;b&&b.setMarkupPaused(!1)},0);a.on("contentDom",e);a.on("beforeCommandExec",function(b){if(b.data.name in d.options.disablingCommandExec&&"wysiwyg"==a.mode){if(b=a.scayt)d.destroy(a),a.fire("scaytButtonState",CKEDITOR.TRISTATE_DISABLED)}else if("bold"===b.data.name||"italic"===b.data.name||"underline"===b.data.name||"strike"===b.data.name||"subscript"===b.data.name||"superscript"===b.data.name)if(b=a.scayt)b.removeMarkupInSelectionNode(),b.fire("startSpellCheck")});a.on("beforeSetMode",function(b){if("source"==
b.data&&(b=a.scayt))d.destroy(a),a.fire("scaytButtonState",CKEDITOR.TRISTATE_DISABLED)});a.on("afterCommandExec",function(b){var c;if("wysiwyg"==a.mode&&("undo"==b.data.name||"redo"==b.data.name))(c=a.scayt)&&setTimeout(function(){c.fire("startSpellCheck")},250)});a.on("readOnly",function(b){var c;b&&(c=a.scayt,!0===b.editor.readOnly?c&&c.fire("removeMarkupInDocument",{}):c?c.fire("startSpellCheck"):"wysiwyg"==b.editor.mode&&!0===d.state[b.editor.name]&&(d.createScayt(a),b.editor.fire("scaytButtonState",
CKEDITOR.TRISTATE_ON)))});a.on("beforeDestroy",c);a.on("setData",function(){c();a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&e()},this,null,50);a.on("insertElement",function(){var b=a.scayt;b&&(b.removeMarkupInSelectionNode(),b.fire("startSpellCheck"))},this,null,50);a.on("insertHtml",function(){var b=a.scayt;b&&(b.removeMarkupInSelectionNode(),b.fire("startSpellCheck"))},this,null,50);a.on("scaytDialogShown",function(b){b.data.selectPage(a.scayt.tabToOpen)})},parseConfig:function(a){var d=CKEDITOR.plugins.scayt3;
d.replaceOldOptionsNames(a.config);"boolean"!==typeof a.config.scayt_autoStartup&&(a.config.scayt_autoStartup=!1);d.state[a.name]=a.config.scayt_autoStartup;a.config.scayt_contextCommands||(a.config.scayt_contextCommands="ignore|ignoreall|add");a.config.scayt_contextMenuItemsOrder||(a.config.scayt_contextMenuItemsOrder="suggest|moresuggest|control");a.config.scayt_sLang||(a.config.scayt_sLang="en_US");if(void 0===a.config.scayt_maxSuggestions||"number"!=typeof a.config.scayt_maxSuggestions||0>a.config.scayt_maxSuggestions)a.config.scayt_maxSuggestions=
5;if(void 0===a.config.scayt_customDictionaryIds||"string"!==typeof a.config.scayt_customDictionaryIds)a.config.scayt_customDictionaryIds="";if(void 0===a.config.scayt_userDictionaryName||"string"!==typeof a.config.scayt_userDictionaryName)a.config.scayt_userDictionaryName=null;if("string"===typeof a.config.scayt_uiTabs&&3===a.config.scayt_uiTabs.split(",").length){var b=[],c=[];a.config.scayt_uiTabs=a.config.scayt_uiTabs.split(",");CKEDITOR.tools.search(a.config.scayt_uiTabs,function(a){if(Number(a)===
1||Number(a)===0){c.push(true);b.push(Number(a))}else c.push(false)});a.config.scayt_uiTabs=null===CKEDITOR.tools.search(c,!1)?b:[1,1,1]}else a.config.scayt_uiTabs=[1,1,1];"string"!=typeof a.config.scayt_serviceProtocol&&(a.config.scayt_serviceProtocol=null);"string"!=typeof a.config.scayt_serviceHost&&(a.config.scayt_serviceHost=null);"string"!=typeof a.config.scayt_servicePort&&(a.config.scayt_servicePort=null);"string"!=typeof a.config.scayt_servicePath&&(a.config.scayt_servicePath=null);a.config.scayt_moreSuggestions||
(a.config.scayt_moreSuggestions="on");"string"!==typeof a.config.scayt_customerId&&(a.config.scayt_customerId="1:WvF0D4-UtPqN1-43nkD4-NKvUm2-daQqk3-LmNiI-z7Ysb4-mwry24-T8YrS3-Q2tpq2");"string"!==typeof a.config.scayt_srcUrl&&(d=document.location.protocol,d=-1!=d.search(/https?:/)?d:"http:",a.config.scayt_srcUrl=d+"//svc.webspellchecker.net/spellcheck31/lf/scayt3/ckscayt/ckscayt.js");"boolean"!==typeof CKEDITOR.config.scayt_handleCheckDirty&&(CKEDITOR.config.scayt_handleCheckDirty=!0);"boolean"!==
typeof CKEDITOR.config.scayt_handleUndoRedo&&(CKEDITOR.config.scayt_handleUndoRedo=!0);if(a.config.scayt_disableOptionsStorage){var d=CKEDITOR.tools.isArray(a.config.scayt_disableOptionsStorage)?a.config.scayt_disableOptionsStorage:"string"===typeof a.config.scayt_disableOptionsStorage?[a.config.scayt_disableOptionsStorage]:void 0,g="all options lang ignore-all-caps-words ignore-domain-names ignore-words-with-mixed-cases ignore-words-with-numbers".split(" "),f=["lang","ignore-all-caps-words","ignore-domain-names",
"ignore-words-with-mixed-cases","ignore-words-with-numbers"],e=CKEDITOR.tools.search,h=CKEDITOR.tools.indexOf;a.config.scayt_disableOptionsStorage=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],i=!!e(a,"options");if(!e(g,d)||i&&e(f,function(a){if(a==="lang")return false}))return;e(f,d)&&f.splice(h(f,d),1);if(d==="all"||i&&e(a,"lang"))return[];d==="options"&&(f=["lang"])}return b=b.concat(f)}(d)}},addRule:function(a){var d=a.dataProcessor,b=d&&d.htmlFilter,c=a._.elementsPath&&a._.elementsPath.filters,
d=d&&d.dataFilter,g=a.addRemoveFormatFilter,f=function(b){var c=CKEDITOR.plugins.scayt3;if(a.scayt&&b.hasAttribute(c.options.data_attribute_name))return!1},e=function(b){var c=CKEDITOR.plugins.scayt3,d=!0;a.scayt&&b.hasAttribute(c.options.data_attribute_name)&&(d=!1);return d};c&&c.push(f);d&&d.addRules({elements:{span:function(b){var c=CKEDITOR.plugins.scayt3;c&&(c.state[a.name]&&b.classes&&CKEDITOR.tools.search(b.classes,c.options.misspelled_word_class))&&(b.classes&&b.parent.type===CKEDITOR.NODE_DOCUMENT_FRAGMENT?
(delete b.attributes.style,delete b.name):delete b.classes[CKEDITOR.tools.indexOf(b.classes,c.options.misspelled_word_class)]);return b}}});b&&b.addRules({elements:{span:function(b){var c=CKEDITOR.plugins.scayt3;c&&(c.state[a.name]&&b.hasClass(c.options.misspelled_word_class)&&b.attributes[c.options.data_attribute_name])&&(b.removeClass(c.options.misspelled_word_class),delete b.attributes[c.options.data_attribute_name],delete b.name);return b}}});g&&g.call(a,e)},scaytMenuDefinition:function(a){var d=
this,a=a.scayt;return{scayt_ignore:{label:a.getLocal("btn_ignore"),group:"scayt_control",order:1,exec:function(a){a.scayt.ignoreWord()}},scayt_ignoreall:{label:a.getLocal("btn_ignoreAll"),group:"scayt_control",order:2,exec:function(a){a.scayt.ignoreAllWords()}},scayt_add:{label:a.getLocal("btn_addWord"),group:"scayt_control",order:3,exec:function(a){var c=a.scayt;setTimeout(function(){c.addWordToUserDictionary()},10)}},option:{label:a.getLocal("btn_options"),group:"scayt_control",order:4,exec:function(a){a.scayt.tabToOpen=
"options";a.lockSelection();a.openDialog(d.dialogName)},verification:function(a){return 1==a.config.scayt_uiTabs[0]?!0:!1}},language:{label:a.getLocal("btn_langs"),group:"scayt_control",order:5,exec:function(a){a.scayt.tabToOpen="langs";a.lockSelection();a.openDialog(d.dialogName)},verification:function(a){return 1==a.config.scayt_uiTabs[1]?!0:!1}},dictionary:{label:a.getLocal("btn_dictionaries"),group:"scayt_control",order:6,exec:function(a){a.scayt.tabToOpen="dictionaries";a.lockSelection();a.openDialog(d.dialogName)},
verification:function(a){return 1==a.config.scayt_uiTabs[2]?!0:!1}},about:{label:a.getLocal("btn_about"),group:"scayt_control",order:7,exec:function(a){a.scayt.tabToOpen="about";a.lockSelection();a.openDialog(d.dialogName)}}}},buildSuggestionMenuItems:function(a,d){var b={},c={},g=a.scayt;if(0<d.length&&"no_any_suggestions"!==d[0])for(var f=0;f<d.length;f++){var e="scayt_suggest_"+CKEDITOR.plugins.scayt3.suggestions[f].replace(" ","_");a.addCommand(e,this.createCommand(CKEDITOR.plugins.scayt3.suggestions[f]));
f<a.config.scayt_maxSuggestions?(a.addMenuItem(e,{label:d[f],command:e,group:"scayt_suggest",order:f+1}),b[e]=CKEDITOR.TRISTATE_OFF):(a.addMenuItem(e,{label:d[f],command:e,group:"scayt_moresuggest",order:f+1}),c[e]=CKEDITOR.TRISTATE_OFF,"on"===a.config.scayt_moreSuggestions&&(a.addMenuItem("scayt_moresuggest",{label:g.getLocal("btn_moreSuggestions"),group:"scayt_moresuggest",order:10,getItems:function(){return c}}),b.scayt_moresuggest=CKEDITOR.TRISTATE_OFF))}else b.no_scayt_suggest=CKEDITOR.TRISTATE_DISABLED,
a.addCommand("no_scayt_suggest",{exec:function(){}}),a.addMenuItem("no_scayt_suggest",{label:g.getLocal("btn_noSuggestions")||"no_scayt_suggest",command:"no_scayt_suggest",group:"scayt_suggest",order:0});return b},menuGenerator:function(a,d){var b=a.scayt,c=this.scaytMenuDefinition(a),g={},f=a.config.scayt_contextCommands.split("|");b.fire("getSuggestionsList",{lang:b.getLang(),word:d});g=this.buildSuggestionMenuItems(a,CKEDITOR.plugins.scayt3.suggestions);if("off"==a.config.scayt_contextCommands)return g;
for(var e in c)-1==CKEDITOR.tools.indexOf(f,e.replace("scayt_",""))&&"all"!=a.config.scayt_contextCommands||(g[e]=CKEDITOR.TRISTATE_OFF,"function"===typeof c[e].verification&&!c[e].verification(a)&&delete g[e],a.addCommand(e,{exec:c[e].exec}),a.addMenuItem(e,{label:a.lang.scayt3[c[e].label]||c[e].label,command:e,group:c[e].group,order:c[e].order}));return g},createCommand:function(a){return{exec:function(d){d.scayt.replaceSelectionNode({word:a})}}}});
CKEDITOR.plugins.scayt3={state:{},suggestions:[],loadingHelper:{loadOrder:[]},isLoading:!1,options:{disablingCommandExec:{source:!0,newpage:!0,templates:!0},data_attribute_name:"data-scayt-word",misspelled_word_class:"scayt-misspell-word"},backCompatibilityMap:{scayt_service_protocol:"scayt_serviceProtocol",scayt_service_host:"scayt_serviceHost",scayt_service_port:"scayt_servicePort",scayt_service_path:"scayt_servicePath",scayt_customerid:"scayt_customerId"},replaceOldOptionsNames:function(a){for(var d in a)d in
this.backCompatibilityMap&&(a[this.backCompatibilityMap[d]]=a[d],delete a[d])},createScayt:function(a){var d=this;this.loadScaytLibrary(a,function(a){var c={lang:a.config.scayt_sLang,container:"BODY"==a.editable().$.nodeName?a.document.getWindow().$.frameElement:a.editable().$,customDictionary:a.config.scayt_customDictionaryIds,userDictionaryName:a.config.scayt_userDictionaryName,localization:a.langCode,customer_id:a.config.scayt_customerId,data_attribute_name:d.options.data_attribute_name,misspelled_word_class:d.options.misspelled_word_class,
"options-to-restore":a.config.scayt_disableOptionsStorage,focused:a.editable().hasFocus};a.config.scayt_serviceProtocol&&(c.service_protocol=a.config.scayt_serviceProtocol);a.config.scayt_serviceHost&&(c.service_host=a.config.scayt_serviceHost);a.config.scayt_servicePort&&(c.service_port=a.config.scayt_servicePort);a.config.scayt_servicePath&&(c.service_path=a.config.scayt_servicePath);c=new SCAYT.CKSCAYT(c,function(){},function(){});c.subscribe("suggestionListSend",function(a){for(var b={},c=[],
d=0;d<a.suggestionList.length;d++)if(!b[a.suggestionList[d]]){b[a.suggestionList[d]]=a.suggestionList[d];c.push(a.suggestionList[d])}CKEDITOR.plugins.scayt3.suggestions=c});a.scayt=c;a.fire("scaytButtonState",a.readOnly?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_ON)})},destroy:function(a){a.scayt&&a.scayt.destroy();delete a.scayt;a.fire("scaytButtonState",CKEDITOR.TRISTATE_OFF)},loadScaytLibrary:function(a,d){var b=this;"undefined"===typeof window.SCAYT||"function"!==typeof window.SCAYT.CKSCAYT?
(this.loadingHelper[a.name]=d,this.loadingHelper.loadOrder.push(a.name),CKEDITOR.scriptLoader.load(a.config.scayt_srcUrl,function(){var a;CKEDITOR.fireOnce("scaytReady");for(var d=0;d<b.loadingHelper.loadOrder.length;d++){a=b.loadingHelper.loadOrder[d];if("function"===typeof b.loadingHelper[a])b.loadingHelper[a](CKEDITOR.instances[a]);delete b.loadingHelper[a]}b.loadingHelper.loadOrder=[]})):window.SCAYT&&"function"===typeof window.SCAYT.CKSCAYT&&(CKEDITOR.fireOnce("scaytReady"),a.scayt||"function"===
typeof d&&d(a))}};
CKEDITOR.on("scaytReady",function(){if(!0===CKEDITOR.config.scayt_handleCheckDirty){var a=CKEDITOR.editor.prototype;a.checkDirty=CKEDITOR.tools.override(a.checkDirty,function(a){return function(){var c=null,d=this.scayt;if(!CKEDITOR.plugins.scayt3||!CKEDITOR.plugins.scayt3.state[this.name]||!this.scayt)c=a.call(this);else if(c="ready"==this.status)var f=d.removeMarkupFromString(this.getSnapshot()),d=d.removeMarkupFromString(this._.previousValue),c=c&&d!==f;return c}});a.resetDirty=CKEDITOR.tools.override(a.resetDirty,
function(a){return function(){var c=this.scayt;!CKEDITOR.plugins.scayt3||!CKEDITOR.plugins.scayt3.state[this.name]||!this.scayt?a.call(this):this._.previousValue=c.removeMarkupFromString(this.getSnapshot())}})}if(!0===CKEDITOR.config.scayt_handleUndoRedo){var a=CKEDITOR.plugins.undo.Image.prototype,d="function"==typeof a.equalsContent?"equalsContent":"equals";a[d]=CKEDITOR.tools.override(a[d],function(a){return function(c){var d=c.editor.scayt,f=this.contents,e=c.contents,h=null;CKEDITOR.plugins.scayt3&&
(CKEDITOR.plugins.scayt3.state[c.editor.name]&&c.editor.scayt)&&(this.contents=d.removeMarkupFromString(f)||"",c.contents=d.removeMarkupFromString(e)||"");h=a.apply(this,arguments);this.contents=f;c.contents=e;return h}})}});