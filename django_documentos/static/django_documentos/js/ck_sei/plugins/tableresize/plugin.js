/*
 Copyright (c) 2003-2014, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
(function(){function t(b){return CKEDITOR.env.ie?b.$.clientWidth:parseInt(b.getComputedStyle("width"),10)}function n(b,i){var a=b.getComputedStyle("border-"+i+"-width"),c={thin:"0px",medium:"1px",thick:"2px"};0>a.indexOf("px")&&(a=a in c&&"none"!=b.getComputedStyle("border-style")?c[a]:0);return parseInt(a,10)}function v(b){var i=[],a=-1,c="rtl"==b.getComputedStyle("direction"),d;d=b.$.rows;for(var p=0,f,g,e,h=0,o=d.length;h<o;h++)e=d[h],f=e.cells.length,f>p&&(p=f,g=e);d=g;p=new CKEDITOR.dom.element(b.$.tBodies[0]);
f=p.getDocumentPosition();g=0;for(e=d.cells.length;g<e;g++){var h=new CKEDITOR.dom.element(d.cells[g]),o=d.cells[g+1]&&new CKEDITOR.dom.element(d.cells[g+1]),a=a+(h.$.colSpan||1),k,j,l=h.getDocumentPosition().x;c?j=l+n(h,"left"):k=l+h.$.offsetWidth-n(h,"right");o?(l=o.getDocumentPosition().x,c?k=l+o.$.offsetWidth-n(o,"right"):j=l+n(o,"left")):(l=b.getDocumentPosition().x,c?k=l:j=l+b.$.offsetWidth);h=Math.max(j-k,3);i.push({table:b,index:a,x:k,y:f.y,width:h,height:p.$.offsetHeight,rtl:c})}return i}
function u(b){(b.data||b).preventDefault()}function z(b){function i(){h=0;e.setOpacity(0);k&&a();var A=f.table;setTimeout(function(){A.removeCustomData("_cke_table_pillars")},0);g.removeListener("dragstart",u)}function a(){for(var a=f.rtl,e=a?l.length:w.length,d=0;d<e;d++){var g=w[d],c=l[d],h=f.table;CKEDITOR.tools.setTimeout(function(b,d,e,f,g,c){b&&b.setStyle("width",j(Math.max(d+c,0)));e&&e.setStyle("width",j(Math.max(f-c,0)));g&&h.setStyle("width",j(g+c*(a?-1:1)))},0,this,[g,g&&t(g),c,c&&t(c),
(!g||!c)&&t(h)+n(h,"left")+n(h,"right"),k])}b.fire("tableResize")}function c(a){u(a);for(var a=f.index,b=CKEDITOR.tools.buildTableMap(f.table),c=[],i=[],j=Number.MAX_VALUE,n=j,s=f.rtl,r=0,v=b.length;r<v;r++){var m=b[r],q=m[a+(s?1:0)],m=m[a+(s?0:1)],q=q&&new CKEDITOR.dom.element(q),m=m&&new CKEDITOR.dom.element(m);if(!q||!m||!q.equals(m))q&&(j=Math.min(j,t(q))),m&&(n=Math.min(n,t(m))),c.push(q),i.push(m)}w=c;l=i;x=f.x-j;y=f.x+n;e.setOpacity(0.5);o=parseInt(e.getStyle("left"),10);k=0;h=1;e.on("mousemove",
p);g.on("dragstart",u);g.on("mouseup",d,this)}function d(a){a.removeListener();i()}function p(a){r(a.data.getPageOffset().x)}var f,g,e,h,o,k,w,l,x,y;g=b.document;e=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',g);b.on("destroy",function(){e.remove()});s||g.getDocumentElement().append(e);
this.attachTo=function(a){h||(s&&(g.getBody().append(e),k=0),f=a,e.setStyles({width:j(a.width),height:j(a.height),left:j(a.x),top:j(a.y)}),s&&e.setOpacity(0.25),e.on("mousedown",c,this),g.getBody().setStyle("cursor","col-resize"),e.show())};var r=this.move=function(a){if(!f)return 0;if(!h&&(a<f.x||a>f.x+f.width))return f=null,h=k=0,g.removeListener("mouseup",d),e.removeListener("mousedown",c),e.removeListener("mousemove",p),g.getBody().setStyle("cursor","auto"),s?e.remove():e.hide(),0;a-=Math.round(e.$.offsetWidth/
2);if(h){if(a==x||a==y)return 1;a=Math.max(a,x);a=Math.min(a,y);k=a-o}e.setStyle("left",j(a));return 1}}function r(b){var i=b.data.getTarget();if("mouseout"==b.name){if(!i.is("table"))return;for(var a=new CKEDITOR.dom.element(b.data.$.relatedTarget||b.data.$.toElement);a&&a.$&&!a.equals(i)&&!a.is("body");)a=a.getParent();if(!a||a.equals(i))return}i.getAscendant("table",1).removeCustomData("_cke_table_pillars");b.removeListener()}var j=CKEDITOR.tools.cssLength,s=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||
CKEDITOR.env.quirks);CKEDITOR.plugins.add("tableresize",{requires:"tabletools",init:function(b){b.on("contentDom",function(){var i;b.document.getBody().on("mousemove",function(a){var a=a.data,c=a.getPageOffset().x;if(i&&i.move(c))u(a);else{var a=a.getTarget(),d;if(a.is("table")||a.getAscendant("tbody",1)){d=a.getAscendant("table",1);if(!(a=d.getCustomData("_cke_table_pillars")))d.setCustomData("_cke_table_pillars",a=v(d)),d.on("mouseout",r),d.on("mousedown",r);a:{d=0;for(var j=a.length;d<j;d++){var f=
a[d];if(c>=f.x&&c<=f.x+f.width){c=f;break a}}c=null}c&&(!i&&(i=new z(b)),i.attachTo(c))}}})})}})})();